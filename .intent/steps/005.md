---
step: 5
title: "redline-ai npmパッケージの全機能実装"
session: "ad99caf6-19e6-4b2b-9669-ab5409d0a74b"
timestamp: 2026-02-17T00:16:59Z
tags: []
---

## prompt

ローカルMarkdownファイルをブラウザでプレビューし、テキスト選択→AI編集→diff確認→Apply/Rejectするツール「redline-ai」を、詳細な実装プランに基づいてゼロから実装。serveモード（スタンドアロンMDプレビュー）とproxyモード（既存サーバー結合）の2モード対応。

## reasoning

既存のAstro統合実装からコードを移植しつつ、フレームワーク非依存のnpmパッケージとして汎用化。Hono+markdown-it+shiki+chokidar+esbuildの技術スタックを採用し、5フェーズに分けて並列エージェントも活用して実装。HMRリロードが複数diff表示時に全パネルを閉じてしまう問題も発見・修正し、パネルカウンターによるリロード抑制機構を追加。

## outcome

npx redline-ai serve ./docsでMarkdownプレビュー+AI編集、npx redline-ai proxyで既存サーバーにオーバーレイ注入が可能に。テキスト選択→AI指示→diff確認→Apply/Rejectのワークフローが動作。39テスト全通過、TypeScriptエラーなし。複数diffの独立操作にも対応。
